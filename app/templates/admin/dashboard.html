{% extends "base.html" %}
{% block content %}

<h2>Admin Dashboard</h2>


<form action="{{ url_for('main.admin_logout') }}" method="GET">
    <button type="submit" class="btn">Logout</button>
</form>




<div class="admin-stats">
    <div><strong>Monthly Earnings:</strong> ₦{{ "{:,.2f}".format(monthly_earnings) }}</div><br>
    <div><strong>Total Orders:</strong> {{ orders_count }}</div><br>
    <div><strong>Total Referrers:</strong> {{ referrers_count }}</div><br>
</div>

<div class="admin-actions">
    <a class="btn btn-primary" style="text-decoration:none" href="{{ url_for('main.add_product') }}">Add Product</a>
    <a class="btn btn-info" style="text-decoration:none" href="{{ url_for('main.referer_requests') }}">Pending Referrer Requests</a>
    <a class="btn btn-warning" style="text-decoration:none" href="{{ url_for('main.admin_withdrawals_view') }}">Withdrawals</a>
    <a class="btn btn-primary" href="{{ url_for('main.staff_verification') }}">Verify Staffs</a>

    <!-- ✅ NEW BUTTON ADDED -->
    <a class="btn btn-success" style="text-decoration:none" href="{{ url_for('main.admin_orders') }}">Manage Orders</a>
</div>

<hr>

<h3>All Products</h3>
{% if products %}
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Price (₦)</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for product in products %}
        <tr>
            <td>{{ product.name }}</td>
            <td>{{ product.description }}</td>
            <td>₦{{ "{:,.2f}".format(product.price) }}</td>
            <td>
                <a class="btn btn-warning btn-sm" style="text-decoration:none" href="{{ url_for('main.edit_product', id=product.id) }}">Edit</a>
                <form action="{{ url_for('main.delete_product', id=product.id) }}" method="POST" style="display:inline;">
                    <button type="submit" style="text-decoration:none" class="btn btn-danger btn-sm" onclick="return confirm('Delete this product?');">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No products available.</p>
{% endif %}

<hr>

<h3>Pending Referrers</h3>
{% if pending_referers %}
<table class="table table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>WhatsApp</th>
            <th>Bank</th>
            <th>Account No.</th>
            <th>Account Name</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for r in pending_referers %}
        <tr>
            <td>{{ r.full_name }}</td>
            <td>{{ r.whatsapp_number }}</td>
            <td>{{ r.bank_name }}</td>
            <td>{{ r.account_number }}</td>
            <td>{{ r.account_name }}</td>
            <td>
                <form action="{{ url_for('main.admin_approve_referer', id=r.id) }}" method="POST" style="display:inline;">
                    <button type="submit" style="text-decoration:none" class="btn btn-success btn-sm">Approve</button>
                </form>
                <form action="{{ url_for('main.admin_reject_referer', id=r.id) }}" method="POST" style="display:inline;">
                    <button type="submit" style="text-decoration:none" class="btn btn-danger btn-sm">Reject</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No pending referrer applications.</p>
{% endif %}

<hr>

<h3>Approved Referrers</h3>
{% if approved_referers %}
<table class="table table-bordered table-success">
    <thead>
        <tr>
            <th>Name</th>
            <th>WhatsApp</th>
            <th>Badge</th>
            <th>Referrals</th>
            <th>Earnings (₦)</th>
            <th>Dashboard</th>
        </tr>
    </thead>
    <tbody>
        {% for r in approved_referers %}
        <tr>
            <td>{{ r.full_name }}</td>
            <td>{{ r.whatsapp_number }}</td>
            <td>{{ r.badge }}</td>
            <td>{{ r.referrals_count }}</td>
            <td>₦{{ "{:,.2f}".format(r.earnings) }}</td>
            <td>
                <a href="{{ url_for('main.referer_dashboard', token=r.token) }}" target="_blank">Open Dashboard</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No approved referrers.</p>
{% endif %}

<hr>

<h3>Recent Orders</h3>
{% if orders %}
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Reference</th>
            <th>Amount (₦)</th>
            <th>Paid</th>
            <th>Delivered</th>
        </tr>
    </thead>
    <tbody>
        {% for o in orders %}
        <tr>
            <td>{{ o.reference }}</td>
            <td>₦{{ "{:,.2f}".format(o.amount) }}</td>
            <td>{{ 'Yes' if o.paid else 'No' }}</td>
            <td>{{ 'Yes' if o.delivered else 'No' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No recent orders.</p>
{% endif %}

{% endblock %}

