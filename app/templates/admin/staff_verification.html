{% extends "base.html" %}
{% block content %}

<h2>Staff Verification Panel</h2>


<div style="width:100%;overflow-x:auto;">
  <table border="1" cellpadding="10" cellspacing="0" width="100%" style="min-width:70px;">
    <thead>
      <tr>
        <th>Profile</th>
        <th>Staff ID</th>
        <th>Name</th>
        <th>Gender</th>
        <th>Role</th>
        <th>Email</th>
        <th>NIN</th>
        <th>Bank</th>
        <th>Account No.</th>
        <th>Account Name</th>
        <th>Nationality</th>
        <th>State</th>
        <th>LGA</th>
        <th>Documents</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      {% for staff in staffs %}
      <tr>

        <td>
          {% if staff.profile_image %}
            <img src="{{ url_for('static', filename=staff.profile_image) }}"
                 style="width:60px;height:60px;border-radius:50%;cursor:pointer;object-fit:cover;"
                 onclick="openImageModal(this.src)"
                 title="Click to view image">
          {% else %}
            <span>No Image</span>
          {% endif %}
        </td>

        <td>{{ staff.staff_id }}</td>
        <td>{{ staff.name }}</td>
        <td>{{ staff.gender }}</td>
        <td>{{ staff.role }}</td>
        <td>{{ staff.email }}</td>
        <td>{{ staff.nin }}</td>
        <td>{{ staff.bank_name }}</td>
        <td>{{ staff.account_number }}</td>
        <td>{{ staff.account_name }}</td>
        <td>{{ staff.nationality }}</td>
<td>{{ staff.state }}</td>
<td>{{ staff.lga }}</td>
<td class="docs-cell">
  {% if staff.documents %}
    <form method="GET" action="{{ url_for('main.download_documents', staff_id=staff.id) }}">
      <button type="submit" class="btn" style="background:blue;color:white;">Download</button>
    </form>
  {% else %}
    <span>No Documents</span>
  {% endif %}
</td>




        <td>
          {% if staff.verification_status == 'approved' %}
            <span style="color:green;font-weight:bold;">Approved</span>
          {% elif staff.verification_status == 'declined' %}
            <span style="color:red;font-weight:bold;">Declined</span>
          {% else %}
            <span style="color:orange;font-weight:bold;">Pending</span>
          {% endif %}
        </td>

        <td style="white-space:nowrap;">

          {% if staff.verification_status == 'pending' %}

  <form method="POST" action="{{ url_for('main.verify_staff', id=staff.id) }}" style="display:inline;">
    <button type="submit" style="background:green;color:white;" class="btn">Approve</button>
  </form>

  <form method="POST" action="{{ url_for('main.decline_staff', id=staff.id) }}" style="display:inline;">
    <button type="submit" style="background:orange;color:white;" class="btn">Decline</button>
  </form>

{% elif staff.verification_status == 'approved' %}

  <span style="color:gray;">âœ” Verified</span>

  <form method="POST"
        action="{{ url_for('main.delete_staff', id=staff.id) }}"
        style="display:inline;margin-left:5px;"
        onsubmit="return confirm('Are you sure you want to permanently delete the approved staff?');">

    <button type="submit" style="background:red;color:white;" class="btn">Terminate</button>
  </form>

{% elif staff.verification_status == 'declined' %}

  <form method="POST"
        action="{{ url_for('main.delete_staff', id=staff.id) }}"
        style="display:inline;"
        onsubmit="return confirm('Are you sure you want to permanently delete this staff?');">

    <button type="submit" style="background:red;color:white;" class="btn">Delete</button>
  </form>


{% endif %}


        </td>

      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<br>

<a href="{{ url_for('main.export_staff_csv') }}">
  <button class="btn">Export Verified Staff Accounts (CSV)</button>
</a>


<div id="imageModal" style="
  display:none;
  position:fixed;
  z-index:9999;
  inset:0;
  background:rgba(0,0,0,0.85);
  padding:10px;
">
  <span onclick="closeImageModal()" style="
    position:absolute;
    top:10px;
    right:15px;
    color:white;
    font-size:32px;
    font-weight:bold;
    cursor:pointer;
  ">&times;</span>

  <img id="modalImage" style="
    display:block;
    max-width:100%;
    max-height:50%;
    margin:auto;
    object-fit:contain;
    border-radius:10px;
  ">
</div>

<script>
function openImageModal(src) {
  document.getElementById('modalImage').src = src;
  document.getElementById('imageModal').style.display = 'flex';
}

function closeImageModal() {
  document.getElementById('imageModal').style.display = 'none';
}
</script>

{% endblock %}

